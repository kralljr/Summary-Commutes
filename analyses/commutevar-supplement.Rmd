---
title: 'Variability in PM2.5 exposures during daily commutes'
subtitle: "Supplementary Material"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = F)
```

```{r}
# libraries
library(tidyverse)
library(knitr)
library(here)
library(ggthemes)
library(DescTools)
library(RColorBrewer)
library(forcats)
library(lubridate)
library(patchwork)

# from roadiness-eda.Rmd
load(here("figures/eda-tabfig.RData"))
# from figure2.R
load(here("figures/fighourly.RData"))

# supplement from roadiness-eda.Rmd
load(here("results/supp-plots.RData"))

```

# Tables

```{r}
k <- 1
```

## Table S`r k`. Demographic characteristics (N (%)) for N=25 commuters.

```{r}
k <- k + 1
```


```{r}
kable(demo)
```




## Table S`r k`. N (%) of categorical weather characteristics for N=45 person-days of observation.

```{r}
k <- k + 1
```

```{r}
kable(catweath)
```



## Table S`r k`. Mean (SD) of wind speed (m/s) and temperature for N=45 person-days of observation.

```{r}
k <- k + 1
```

```{r}
kable(contweat)
```

# Figures

```{r}
k <- 1
```




## Figure S`r k`. Distributions of daily ambient PM$_{2.5}$ ($\mu$g/m$^3$) and hourly PM$_{2.5}$ ($\mu$g/m$^3$) for days of observation (N=38)

```{r}
k <- k + 1
```

```{r}
# get data
va24 <- dailypm[[2]]

rcomm1 <- boxplot1[[2]]
ns <- boxplot1[[3]]

dates <- select(rcomm1, date) %>% unique() %>% rename(date_local = date)
obsdiff0 <- fighourly[[2]]
obsdiff <- left_join(dates, obsdiff0)
alps <- fighourly[[3]] - 0.2
cols <- fighourly[[4]]


# add in median daily PM for hourly
va241 <- dplyr::select(va24, daily) %>% 
  mutate(type = "daily") 
sva <- summarize(va241, med = median(daily))
obsdiff1 <- dplyr::select(obsdiff, time_local, obsdiff) %>%
  mutate(type = "hourly", obsdiff = obsdiff + sva$med,
         type2 = paste0("Hour:", time_local)) %>%
  rename(pm = obsdiff) %>% dplyr::select(-time_local)
va241 <- dplyr::select(va24, daily) %>% 
  mutate(type = "Daily", type2 = "Daily") %>%
  rename(pm = daily)
vals <- c("Daily", paste0("Hour:", seq(0, 23)))
dhour <- bind_rows(obsdiff1, va241) %>%
  mutate(type2 = factor(type2, levels = vals))
```



```{r}
fighourly <- ggplot() +
  geom_boxplot(data = dhour, aes(x = factor(type2), y = pm, colour = type)) +
  geom_vline(xintercept = 1.5, colour = "grey20", size = 1) +
  ylab(expression(paste("PM"[2.5], " (", mu, "g/m"^3, ")"))) +#, #"\nrelative to daily average"))) +
  xlab("") +
  scale_color_manual(values =c(1, cols[1]), guide = "none") +
  theme_bw() +
  theme(text = element_text(size = 12),
        axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
fighourly
```






## Figure S`r k`. Wind rose plot showing direction of the fastest wind sustained over five minutes across N=45 person-days of observation.

```{r}
k <- k + 1
```

```{r}
winddir1
```

