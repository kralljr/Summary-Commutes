---
title: 'Variability in PM2.5 exposures during daily commutes'
subtitle: "Tables and figures"
output: 
  html_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = F)
```

```{r}
# libraries
library(tidyverse)
library(knitr)
library(here)
library(ggthemes)
library(DescTools)
library(RColorBrewer)
library(forcats)
library(lubridate)
library(patchwork)

figloc <- "~/Dropbox/CommuteVar/figures"

# from roadiness-eda.Rmd
load(here("figures/eda-tabfig.RData"))
# from figure2.R
load(here("figures/fighourly.RData"))

# paired analysis
load(file.path(figloc, "figpaired.RData"))

# masstime
load(here("results/masstime.RData"))

# icc
load(here("results/icc.RData"))

# lm res

load(here("results/lmfig.RData"))

```





# Tables
```{r}
k <- 1

```


## Table `r k`. Intraclass correlations (ICC) comparing between-participant to within-participant variability by levels of road features.

```{r}
k <- k + 1
```

```{r}
kable(icc, digits = 2)
```


# Figures
```{r}
k <- 1

```




## Figure `r k`. For each observed trip (N=69), variation in road type and PM$_{2.5}$ over each trip.  PM$_{2.5}$ is shown as the difference in log $\mu$g/m$^3$ from the trip-specific mean to better visualize changes across each trip.

```{r}
k <- k + 1
```


```{r}
rcomm1 <- tripplot[[2]]
```

```{r}
roadtype2 <- ggplot(rcomm1, aes(x = timemin, y = id2, fill = rtype)) +
  geom_tile() + ylab("Trip") + xlab("Minutes since obs trip start") +
  scale_fill_colorblind(name = "Road type") +
 # theme_bw() +
  theme(text = element_text(size=12), axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.position  = c(.75, .25))

pmtile <- ggplot(rcomm1, aes(x = timemin, y = id2, fill = lPM2)) +
  geom_tile() + ylab("Trip") + xlab("Minutes since obs trip start") +
  scale_fill_gradient2(name = "log PM2.5 difference", low = "green", high = "red",
                       mid = "white") +
  #theme_bw() +
  theme(text = element_text(size=12), axis.text.y = element_blank(),
        axis.ticks.y = element_blank(), legend.position = c(.75, .25))

tripplot <- roadtype2 + pmtile
tripplot[[2]] = tripplot[[2]] + theme(axis.text.y = element_blank(),
                                        axis.ticks.y = element_blank(),
                                        axis.title.y = element_blank() )

tripplot

```


## Figure `r k`. Boxplot of differences in PM$_{2.5}$ between commute pairs (N=12)

```{r}
k <- k + 1
```

```{r}
figpaired
```



## Figure `r k`. Mean (95% confidence intervals) mass-time ratio of PM$_{2.5}$ by levels of road features.  

```{r}
k <- k + 1
```


```{r}
masstime2
```




## Figure `r k`. Associations of road type with in-vehicle PM$_{2.5}$ concentrations from linear mixed models.  Results are reported as the change in log $\mu$g/m$^3$ comparing travelling on highways, local connecting roads, and ramps/tunnels to local roads.  Results include main models as well as models adjusted for meteorology, ambient PM$_{2.5}$, and rush hour commutes.

```{r}
k <- k + 1
```


```{r}
fig5
```




## Figure `r k`. Associations of speed and roadiness with in-vehicle PM$_{2.5}$ concentrations from linear mixed models.  Results are reported as the change in log $\mu$g/m$^3$ for an interquartile (IQR) increase in speed or roadiness.   Results include main models as well as models adjusted for meteorology, ambient PM$_{2.5}$, and rush hour commutes.
 

```{r}
k <- k + 1
```


```{r}
fig6
```
