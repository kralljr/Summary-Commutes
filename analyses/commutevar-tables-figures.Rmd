---
title: "Short-term associations between road features and in-vehicle PM2.5 during
  daily trips"
subtitle: Main text figures
output:
  pdf_document:
    toc: yes
    keep_tex: true
  html_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F, cache = F)
```

```{r}
# libraries
library(tidyverse)
library(knitr)
library(here)
library(ggthemes)
library(DescTools)
library(RColorBrewer)
library(forcats)
library(lubridate)
library(patchwork)

figloc <- "~/Dropbox/CommuteVar/figures"

# from roadiness-eda.Rmd
load(here("figures/eda-tabfig.RData"))
# from figure2.R
load(here("figures/fighourly.RData"))

# paired analysis
load(file.path(figloc, "figpaired.RData"))

# masstime
load(here("results/masstime.RData"))


# lm res

load(here("results/lmfig.RData"))

```







# Figures
```{r}
k <- 1

```




## Figure `r k`. Variation in road type (highway, ramp/tunnel, local connecting, and local roads) and PM$_{2.5}$ (in standard deviations (SD) from trip-specific means) over each observed trip (N=69).  

```{r}
k <- k + 1
```


```{r}
rcomm1 <- tripplot[[2]]
```

```{r}
roadtype2 <- ggplot(rcomm1, aes(x = timemin, y = id2, fill = rtype2)) +
  geom_tile() + ylab("Trip") + xlab("Minutes since trip start") +
  scale_fill_colorblind(name = "Road type") +
 # theme_bw() +
  theme(text = element_text(size=12), axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        legend.position  = c(.75, .25))

pmtile <- ggplot(rcomm1, aes(x = timemin, y = id2, fill = lPM2)) +
  geom_tile() + ylab("Trip") + xlab("Minutes since trip start") +
  # scale_fill_gradient2(name = "Change in PM2.5 (SD)", low = "green", high = "red",
                       # mid = "white") +
  scale_fill_gradient2(name = "Change in PM2.5 (SD)", low = "#dedc59", high = "#5c3a85", mid = "white") +

  #theme_bw() +
  theme(text = element_text(size=12), axis.text.y = element_blank(),
        axis.ticks.y = element_blank(), legend.position = c(.75, .25))

tripplot <- roadtype2 + pmtile
tripplot[[2]] = tripplot[[2]] + theme(axis.text.y = element_blank(),
                                        axis.ticks.y = element_blank(),
                                        axis.title.y = element_blank() )

tripplot

```


## Figure `r k`. Distributions of absolute PM$_{2.5}$ differences ($\mu$g/m$^3$) across observations for each commute pair (N=12)

```{r}
k <- k + 1
```

```{r}
figpaired
```



## Figure `r k`. Mean (95% confidence intervals) mass-time ratio of PM$_{2.5}$ by road features, including road types and quartiles of roadiness and speed.  

```{r}
k <- k + 1
```


```{r}
masstime2
```




## Figure `r k`. Associations of road type with in-vehicle PM$_{2.5}$ concentrations from linear mixed models, reported as the change in log $\mu$g/m$^3$ (95% confidence intervals) comparing travelling on highways, local connecting roads, and ramps/tunnels to local roads.  Results include main models as well as models adjusted for meteorology, ambient PM$_{2.5}$, and rush hour trips, and all road features.

```{r}
k <- k + 1
```


```{r}
fig5
```




## Figure `r k`. Associations of speed and roadiness with in-vehicle PM$_{2.5}$ concentrations from linear mixed models, reported as the change in log $\mu$g/m$^3$ (95% confidence interval) for an interquartile (IQR) increase in speed or roadiness.   Results include main models as well as models adjusted for meteorology, ambient PM$_{2.5}$, rush hour trips, and all road features.
 

```{r}
k <- k + 1
```


```{r}
fig6
```
